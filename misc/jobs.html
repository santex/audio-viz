<!DOCTYPE html>
<html>
  <head>
    <title>Protovis - Job Voyager</title>
    <link type="text/css" rel="stylesheet" href="../style.css?3.2"/>
    <link type="text/css" rel="stylesheet" href="syntax.css"/>
    <script type="text/javascript" src="../protovis-r3.2.js"></script>
  </head>
  <body>

    <div class="title">
      <div class="subtitle">
        A graphical toolkit for visualization
      </div>
      <a href="../">Protovis</a>
    </div>

    <div class="head">
      <div class="section">
        <a href="../">Overview</a>
      </div>
      <div class="section selected">
        <a href="./">Examples</a>
      </div>
      <div class="section">
        <a href="../docs/">Documentation</a>
      </div>
      <div class="section">
        <a href="https://github.com/mbostock/protovis/zipball/v3.3.1">Download</a>
      </div>
    </div>
    <div class="subhead">
      <div class="section">
        <a href="./">Index</a>
      </div>
      <div class="section">
        <a href="cars.html">&laquo; Previous</a> /
        <a href="minnesota.html">Next &raquo;</a>
      </div>
    </div>

    <div class="body">
      <h1>Job Voyager</h1>

      <iframe scrolling="no" id="iframe" style="height:620px;"
      src="jobs-full.html"></iframe> <p><img src="popout.png" width="16"
      height="16" style="padding:0;vertical-align:top;"> <a
      style="font-size:13px;" href="jobs-full.html" target="_blank">View full
      screen.</a>

      <p>This visualization is a port of the
      Flare <a href="http://flare.prefuse.org/apps/job_voyager">Job Voyager</a>,
      which was in turn inspired by
      the <a href="http://www.babynamewizard.com/voyager">Name Voyager</a>:

      <blockquote style="font-size:13px;">
      This visualization shows stacked time series of reported occupations in
      the United States Labor Force from 1850-2000. The data has been
      normalized: for each census year, the percentage of the polled labor force
      in each occupation is shown. The data is originally from the United States
      Census Bureau and was provided by the University of Minnesota Population
      Center (<a href="http://ipums.org/">ipums.org</a>).
      </blockquote>

      <p>Men are shown in blue; women in red. This version allows you to
      enter <a href="http://en.wikipedia.org/wiki/Regular_expression">regular
      expressions</a> as search patterns. For example, you can view the
      transition
      from <a href="javascript:iframe.search('loco|road')">locomotives to
      automobiles</a>, or compare jobs ending
      in <a href="javascript:iframe.search('ist\\b')">"ist"</a>,
      <a href="javascript:iframe.search('er\\b')">"er"</a>,
      <a href="javascript:iframe.search('ess\\b')">"ess"</a> and
      <a href="javascript:iframe.search('or\\b')">"or"</a>!

      <blockquote style="font-size:13px;">
        Next: <a href="minnesota.html">Minnesota Employment</a>
      </blockquote>

      <h3>Source</h3>

<div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Job Voyager<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;ex.css?3.2&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../protovis-r3.2.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;jobs.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>

<span class="nf">#fig</span> <span class="p">{</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">860px</span><span class="p">;</span>
  <span class="k">height</span><span class="o">:</span> <span class="m">580px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#footer</span> <span class="p">{</span>
  <span class="k">font</span><span class="o">:</span> <span class="m">24pt</span> <span class="n">helvetica</span> <span class="n">neue</span><span class="p">;</span>
  <span class="k">padding-left</span><span class="o">:</span> <span class="m">40px</span><span class="p">;</span>
  <span class="k">color</span><span class="o">:</span> <span class="m">#666</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#footer</span> <span class="nt">input</span> <span class="p">{</span>
  <span class="k">font</span><span class="o">:</span> <span class="m">24pt</span> <span class="n">helvetica</span> <span class="n">neue</span><span class="p">;</span>
  <span class="k">background</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
  <span class="k">border</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
  <span class="k">outline</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

    <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;center&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">id=</span><span class="s">&quot;fig&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;text-align:right;padding-right:20;&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;b&gt;</span>Gender:<span class="nt">&lt;/b&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;radio&quot;</span> <span class="na">name=</span><span class="s">&quot;gender&quot;</span> <span class="na">id=</span><span class="s">&quot;men&quot;</span> <span class="na">onchange=</span><span class="s">&quot;update(gender = 1);&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;men&quot;</span><span class="nt">&gt;</span>Men<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;radio&quot;</span> <span class="na">name=</span><span class="s">&quot;gender&quot;</span> <span class="na">id=</span><span class="s">&quot;women&quot;</span> <span class="na">onchange=</span><span class="s">&quot;update(gender = 2);&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;women&quot;</span><span class="nt">&gt;</span>Women<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;radio&quot;</span> <span class="na">name=</span><span class="s">&quot;gender&quot;</span> <span class="na">id=</span><span class="s">&quot;any&quot;</span> <span class="na">checked</span> <span class="na">onchange=</span><span class="s">&quot;update(gender = 0);&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;any&quot;</span><span class="nt">&gt;</span>Any<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript+protovis&quot;</span><span class="nt">&gt;</span>

<span class="cm">/* Interaction state. */</span>
<span class="kd">var</span> <span class="nx">gender</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">re</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

<span class="cm">/* Flatten the tree into an array to faciliate transformation. */</span>
<span class="kd">var</span> <span class="nx">jobs</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">jobs</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="p">(</span><span class="nx">g</span> <span class="o">==</span> <span class="s2">&quot;men&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">years</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;people&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">array</span><span class="p">();</span>

<span class="cm">/*</span>
<span class="cm"> * Use per-year sums to normalize the data, so we can compute a</span>
<span class="cm"> * percentage. Use per-gender+job sums to determine a saturation encoding.</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">sumByYear</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">nest</span><span class="p">(</span><span class="nx">jobs</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">rollup</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">sum</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">people</span><span class="p">)),</span>
  <span class="nx">sumByJob</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">nest</span><span class="p">(</span><span class="nx">jobs</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">gender</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">job</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">rollup</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">sum</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">people</span><span class="p">));</span>

<span class="cm">/* Cache the percentage of people employed per year. */</span>
<span class="nx">jobs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nx">d</span><span class="p">.</span><span class="nx">people</span> <span class="o">/</span> <span class="nx">sumByYear</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">]);</span>

<span class="cm">/* Sizing parameters and scales. */</span>
<span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
    <span class="nx">h</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">(</span><span class="mi">1850</span><span class="p">,</span> <span class="mi">2000</span><span class="p">).</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">w</span><span class="p">),</span>
    <span class="nx">y</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">).</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">h</span><span class="p">),</span>
    <span class="nx">color</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Scale</span><span class="p">.</span><span class="nx">ordinal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nx">range</span><span class="p">(</span><span class="s2">&quot;#33f&quot;</span><span class="p">,</span> <span class="s2">&quot;#f33&quot;</span><span class="p">),</span>
    <span class="nx">alpha</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">sumByJob</span><span class="p">)).</span><span class="nx">range</span><span class="p">(.</span><span class="mi">4</span><span class="p">,</span> <span class="p">.</span><span class="mi">8</span><span class="p">);</span>

<span class="cm">/* The root panel. */</span>
<span class="kd">var</span> <span class="nx">vis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Panel</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">top</span><span class="p">(</span><span class="mf">9.5</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="mf">39.5</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">right</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>

<span class="cm">/* A background bar to reset the search query.  */</span>
<span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Bar</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="nx">search</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">cursor</span><span class="p">(</span><span class="s2">&quot;pointer&quot;</span><span class="p">);</span>

<span class="cm">/* Y-axis ticks and labels. */</span>
<span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Rule</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="nx">y</span><span class="p">.</span><span class="nx">ticks</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">strokeStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="nx">y</span> <span class="o">?</span> <span class="s2">&quot;#ccc&quot;</span> <span class="o">:</span> <span class="s2">&quot;#000&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">y</span><span class="p">.</span><span class="nx">tickFormat</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">);</span>

<span class="cm">/* Stack layout. */</span>
<span class="kd">var</span> <span class="nx">area</span> <span class="o">=</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Layout</span><span class="p">.</span><span class="nx">Stack</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">layers</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">nest</span><span class="p">(</span><span class="nx">jobs</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">test</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">gender</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">job</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">sortKeys</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">reverseOrder</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nx">b</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
        <span class="p">.</span><span class="nx">entries</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">values</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">x</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">y</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">y</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">percent</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Area</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">def</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">alpha</span><span class="p">(</span><span class="nx">sumByJob</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">key</span><span class="p">]))</span>
    <span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">color</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">gender</span><span class="p">).</span><span class="nx">alpha</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">alpha</span><span class="p">()))</span>
    <span class="p">.</span><span class="nx">cursor</span><span class="p">(</span><span class="s2">&quot;pointer&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;mouseover&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">alpha</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">title</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">job</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;mouseout&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">alpha</span><span class="p">(</span><span class="kc">null</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">search</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">job</span> <span class="o">+</span> <span class="s2">&quot;$&quot;</span><span class="p">));</span>

<span class="cm">/* Stack labels. */</span>
<span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Panel</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">area</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Area</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">area</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">def</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">values</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">percent</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">visible</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">max</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">font</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">y</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">percent</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;px sans-serif&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">textMargin</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="s2">&quot;rgba(0, 0, 0, &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">y</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">percent</span><span class="p">))</span> <span class="o">/</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">textAlign</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">?</span> <span class="s2">&quot;left&quot;</span> <span class="o">:</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="nx">p</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

<span class="cm">/* X-axis ticks and labels. */</span>
<span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Rule</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="mi">1850</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">);</span>

<span class="cm">/* Update the query regular expression when text is entered. */</span>
<span class="kd">function</span> <span class="nx">search</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">text</span> <span class="o">!=</span> <span class="nx">re</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">query</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
      <span class="nx">query</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">);</span>
    <span class="nx">update</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Tests to see whether the specified datum matches the current filters. */</span>
<span class="kd">function</span> <span class="nx">test</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="nx">gender</span> <span class="o">||</span> <span class="nx">d</span><span class="p">.</span><span class="nx">gender</span> <span class="o">==</span> <span class="nx">gender</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">job</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">re</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Recompute the y-scale domain based on query filtering. */</span>
<span class="kd">function</span> <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">y</span><span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">nest</span><span class="p">(</span><span class="nx">jobs</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">test</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">rollup</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">sum</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">percent</span><span class="p">))))));</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">vis</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>

    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;query&quot;</span><span class="nt">&gt;</span>search: <span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;query&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">onkeyup=</span><span class="s">&quot;search(this.value);&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


      <h3>Data</h3>

      Due to size, the data file is omitted from this
      example. See <a href="jobs.js" target="_blank">jobs.js</a>.

    </div>

    <div class="foot">
      Copyright 2010 <a href="http://vis.stanford.edu">Stanford Visualization Group</a>
    </div>

    <script type="text/javascript" src="http://www.google-analytics.com/ga.js"></script>
    <script type="text/javascript">_gat._getTracker("UA-10741907-2")._trackPageview();</script>
  </body>
</html>

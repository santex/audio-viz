<!DOCTYPE html>
<html>
  <head>
    <title>Protovis - Marey&rsquo;s Trains</title>
    <link type="text/css" rel="stylesheet" href="../style.css?3.2"/>
    <link type="text/css" rel="stylesheet" href="syntax.css"/>
    <script type="text/javascript" src="../protovis-r3.2.js"></script>
  </head>
  <body>

    <div class="title">
      <div class="subtitle">
        A graphical toolkit for visualization
      </div>
      <a href="../">Protovis</a>
    </div>

    <div class="head">
      <div class="section">
        <a href="../">Overview</a>
      </div>
      <div class="section selected">
        <a href="./">Examples</a>
      </div>
      <div class="section">
        <a href="../docs/">Documentation</a>
      </div>
      <div class="section">
        <a href="https://github.com/mbostock/protovis/zipball/v3.3.1">Download</a>
      </div>
    </div>
    <div class="subhead">
      <div class="section">
        <a href="./">Index</a>
      </div>
      <div class="section">
        <a href="weather.html">&laquo; Previous</a> /
        <a href="stem-and-leaf.html">Next &raquo;</a>
      </div>
    </div>

    <div class="body">
      <h1>Marey&rsquo;s Trains</h1>

      <iframe style="border:solid 4px #ccc;height:720px;"
      src="caltrain-full.html"></iframe><p><img src="popout.png" width="16"
      height="16" style="padding:0;vertical-align:top;"> <a
      style="font-size:13px;" href="caltrain-full.html" target="_blank">View
      full screen.</a> </p>

      <p>This example recreates the <a
      href="http://www.caltrain.com/timetable.html">CalTrain timetable</a> in
      the style of <a
      href="http://en.wikipedia.org/wiki/%C3%89tienne-Jules_Marey">E. J. Marey</a>&rsquo;s
      <a href="marey-train-schedule.jpg" target="_blank">graphical
      schedule</a>. Stations are separated vertically in proportion to
      geography; thus, the slope of the line reflects the actual speed of the
      train: the steeper the line, the faster the train. This display also
      reveals when and where <span style="color:rgb(183,116,9);">limited
      service</span> trains are passed by <span
      style="color:rgb(192,62,29);">baby bullets</span>.

      <blockquote style="font-size:13px;">
        Next: <a href="stem-and-leaf.html">Stemplots</a>
      </blockquote>

      <h3>Source</h3>

<div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>CalTrain Timetable<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;ex.css?3.2&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;../protovis-r3.2.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;caltrain.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>

<span class="nf">#fig</span> <span class="p">{</span>
  <span class="k">height</span><span class="o">:</span> <span class="m">680px</span><span class="p">;</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">1400px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#controls</span> <span class="p">{</span>
  <span class="k">padding-left</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
<span class="p">}</span>

    <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;&lt;div</span> <span class="na">id=</span><span class="s">&quot;center&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">id=</span><span class="s">&quot;fig&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;controls&quot;</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;b&gt;</span>Speed:<span class="nt">&lt;/b&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">id=</span><span class="s">&quot;normal&quot;</span> <span class="na">checked</span> <span class="na">onchange=</span><span class="s">&quot;speedn = this.checked; vis.render();&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;normal&quot;</span> <span class="na">style=</span><span class="s">&quot;color:rgb(34,34,34);&quot;</span><span class="nt">&gt;</span>Normal<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">id=</span><span class="s">&quot;limited&quot;</span> <span class="na">checked</span> <span class="na">onchange=</span><span class="s">&quot;speedl = this.checked; vis.render();&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;limited&quot;</span> <span class="na">style=</span><span class="s">&quot;color:rgb(183,116,9);&quot;</span><span class="nt">&gt;</span>Limited<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">id=</span><span class="s">&quot;bullet&quot;</span> <span class="na">checked</span> <span class="na">onchange=</span><span class="s">&quot;speedb = this.checked; vis.render();&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;bullet&quot;</span> <span class="na">style=</span><span class="s">&quot;color:rgb(192,62,29);&quot;</span><span class="nt">&gt;</span>Bullet<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;b</span> <span class="na">style=</span><span class="s">&quot;margin-left:6em;&quot;</span><span class="nt">&gt;</span>Direction:<span class="nt">&lt;/b&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">id=</span><span class="s">&quot;northbound&quot;</span> <span class="na">checked</span> <span class="na">onchange=</span><span class="s">&quot;dirn = this.checked; vis.render();&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;northbound&quot;</span><span class="nt">&gt;</span>Northbound<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">id=</span><span class="s">&quot;southbound&quot;</span> <span class="na">checked</span> <span class="na">onchange=</span><span class="s">&quot;dirs = this.checked; vis.render();&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;southbound&quot;</span><span class="nt">&gt;</span>Southbound<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;b</span> <span class="na">style=</span><span class="s">&quot;margin-left:6em;&quot;</span><span class="nt">&gt;</span>Days:<span class="nt">&lt;/b&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;weekdays&quot;</span> <span class="na">name=</span><span class="s">&quot;daySelect&quot;</span> <span class="na">value=</span><span class="s">&quot;Wk&quot;</span> <span class="na">type=</span><span class="s">&quot;radio&quot;</span> <span class="na">checked</span> <span class="na">onchange=</span><span class="s">&quot;oper = this.value; vis.render();&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;weekdays&quot;</span><span class="nt">&gt;</span>Weekdays<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;daySelect&quot;</span> <span class="na">id=</span><span class="s">&quot;saturday&quot;</span> <span class="na">value=</span><span class="s">&quot;Sa&quot;</span> <span class="na">type=</span><span class="s">&quot;radio&quot;</span> <span class="na">onchange=</span><span class="s">&quot;oper = this.value; vis.render();&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;saturday&quot;</span><span class="nt">&gt;</span>Saturday<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;daySelect&quot;</span> <span class="na">id=</span><span class="s">&quot;sunday&quot;</span> <span class="na">value=</span><span class="s">&quot;Su&quot;</span> <span class="na">type=</span><span class="s">&quot;radio&quot;</span> <span class="na">onchange=</span><span class="s">&quot;oper = this.value; vis.render();&quot;</span>
      <span class="nt">&gt;&lt;label</span> <span class="na">for=</span><span class="s">&quot;sunday&quot;</span><span class="nt">&gt;</span>Sunday<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript+protovis&quot;</span><span class="nt">&gt;</span>

<span class="c1">// Start with showing all trains on weekdays</span>
<span class="kd">var</span> <span class="nx">dirn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">dirs</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">oper</span> <span class="o">=</span> <span class="s2">&quot;Wk&quot;</span><span class="p">,</span>
    <span class="nx">speedn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">speedl</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">speedb</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="c1">// Flatten the data so that we have an array of (Train x Station x Time)</span>
<span class="nx">northbound</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">northbound</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">stationsNS</span><span class="p">[</span><span class="nx">stationsNS</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">array</span><span class="p">();</span>

<span class="nx">southbound</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">southbound</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">stationsNS</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">array</span><span class="p">();</span>

<span class="c1">// Label the trains with their directions of travel</span>
<span class="nx">northbound</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">bound</span> <span class="o">=</span> <span class="s2">&quot;N&quot;</span><span class="p">);</span>
<span class="nx">southbound</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">bound</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span><span class="p">);</span>

<span class="c1">// Concatinate the northbound and southbound trains to make a list of all trains</span>
<span class="kd">var</span> <span class="nx">allTrains</span> <span class="o">=</span> <span class="nx">northbound</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">southbound</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// Parse the stop time and do some extra clean up</span>
<span class="nx">allTrains</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// parse type</span>
  <span class="nx">stop</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">train</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="nx">stop</span><span class="p">.</span><span class="nx">train</span> <span class="o">=</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">train</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>

  <span class="c1">// check to see if the stop is an interconnect</span>
  <span class="kd">var</span> <span class="nx">time</span> <span class="o">=</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;i&quot;</span> <span class="o">?</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">time</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">pm</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;pm&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">// parseInt(&quot;09&quot;) == 0 because it assumes octal</span>
    <span class="kd">var</span> <span class="nx">pm</span> <span class="o">=</span> <span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;pm&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">h</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="nx">pm</span> <span class="o">=</span> <span class="o">!</span><span class="nx">pm</span> <span class="c1">// for 12 we have to swap am and pm because time is retarded</span>
  <span class="nx">time</span> <span class="o">=</span> <span class="nx">h</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="nx">m</span> <span class="o">+</span> <span class="p">(</span><span class="nx">pm</span><span class="o">?</span><span class="mi">720</span><span class="o">:</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// calculate the number of minutes from midnight</span>
  <span class="nx">stop</span><span class="p">.</span><span class="nx">mins</span> <span class="o">=</span> <span class="nx">time</span> <span class="o">+</span> <span class="p">((</span><span class="nx">time</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">)</span><span class="o">?</span><span class="mi">1440</span><span class="o">:</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// make the day switch at 3am instead of midnight</span>
<span class="p">});</span>

<span class="c1">// Nest the trains-stops by train as we will draw one line per train</span>
<span class="kd">var</span> <span class="nx">trains</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">nest</span><span class="p">(</span><span class="nx">allTrains</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">train</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">entries</span><span class="p">();</span>

<span class="c1">// Initialize the variables</span>
<span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
    <span class="nx">h</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
    <span class="nx">minHour</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="nx">maxHour</span> <span class="o">=</span> <span class="mi">26</span><span class="p">,</span>
    <span class="nx">showMin</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
    <span class="nx">showMax</span> <span class="o">=</span> <span class="mi">26</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span>

<span class="c1">// Make the scale functions</span>
<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">(</span><span class="nx">showMin</span><span class="p">,</span> <span class="nx">showMax</span><span class="p">).</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">w</span><span class="p">),</span>
    <span class="nx">s2d</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Scale</span><span class="p">.</span><span class="nx">ordinal</span><span class="p">(</span><span class="nx">stationsNS</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">range</span><span class="p">(</span><span class="nx">stationsNS</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">dist</span><span class="p">),</span>
    <span class="nx">y</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">(</span><span class="nx">stationsNS</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">dist</span><span class="p">).</span><span class="nx">range</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="nx">by</span><span class="p">(</span><span class="nx">s2d</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">hourText</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">d</span><span class="o">/</span><span class="mi">60</span> <span class="o">%</span> <span class="mi">24</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">h</span><span class="o">==</span><span class="mi">0</span><span class="o">?</span><span class="s1">&#39;MIDNIGHT&#39;</span><span class="o">:</span><span class="p">(</span><span class="nx">h</span><span class="o">==</span><span class="mi">12</span><span class="o">?</span><span class="s1">&#39;NOON&#39;</span><span class="o">:</span><span class="p">(</span><span class="nx">h</span><span class="o">&lt;</span><span class="mi">12</span><span class="o">?</span><span class="nx">h</span><span class="o">:</span><span class="nx">h</span><span class="o">-</span><span class="mi">12</span><span class="p">)));</span>
<span class="p">}</span>

<span class="c1">// The root panel, with padding for labels</span>
<span class="kd">var</span> <span class="nx">vis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Panel</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">right</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">top</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>

<span class="c1">// Add hour lines</span>
<span class="kd">var</span> <span class="nx">hour</span> <span class="o">=</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Rule</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">showMin</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="nx">showMax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">strokeStyle</span><span class="p">(</span><span class="s2">&quot;#eee&quot;</span><span class="p">);</span>

<span class="nx">hour</span><span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="p">(</span><span class="nx">h</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">%</span> <span class="mi">24</span><span class="p">)</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">?</span> <span class="s2">&quot;#999&quot;</span> <span class="o">:</span> <span class="s2">&quot;#000&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">hourText</span><span class="p">);</span>

<span class="nx">hour</span><span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="p">(</span><span class="nx">h</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">%</span> <span class="mi">24</span><span class="p">)</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">?</span> <span class="s2">&quot;#999&quot;</span> <span class="o">:</span> <span class="s2">&quot;#000&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">hourText</span><span class="p">);</span>

<span class="c1">// Add station lines</span>
<span class="kd">var</span> <span class="nx">station</span> <span class="o">=</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Rule</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">stationsNS</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">y</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">name</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">strokeStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">bullet</span> <span class="o">?</span> <span class="s2">&quot;#bbb&quot;</span> <span class="o">:</span> <span class="s2">&quot;#eee&quot;</span><span class="p">);</span>

<span class="nx">station</span><span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">bullet</span> <span class="o">?</span> <span class="s2">&quot;#000&quot;</span> <span class="o">:</span> <span class="s2">&quot;#888&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

<span class="nx">station</span><span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">bullet</span> <span class="o">?</span> <span class="s2">&quot;#000&quot;</span> <span class="o">:</span> <span class="s2">&quot;#888&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

<span class="c1">// A panel for each train</span>
<span class="kd">var</span> <span class="nx">panel</span> <span class="o">=</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Panel</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">trains</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">visible</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">train</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">train</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">speedb</span> <span class="o">&amp;&amp;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">speedl</span> <span class="o">&amp;&amp;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">speedn</span> <span class="o">&amp;&amp;</span> <span class="sr">/N|W|S/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">type</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dirn</span> <span class="o">&amp;&amp;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">bound</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dirs</span> <span class="o">&amp;&amp;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">bound</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">switch</span> <span class="p">(</span><span class="nx">oper</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s2">&quot;Wk&quot;</span><span class="o">:</span> <span class="k">return</span> <span class="sr">/N|L|B/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
            <span class="k">case</span> <span class="s2">&quot;Su&quot;</span><span class="o">:</span> <span class="k">return</span> <span class="sr">/W|S/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
            <span class="k">default</span><span class="o">:</span> <span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;W&quot;</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">});</span>

<span class="c1">// A line curve (with dots) for each station</span>
<span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">panel</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Line</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="nx">d</span><span class="p">.</span><span class="nx">values</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span> <span class="nx">x</span><span class="p">(</span><span class="nx">stop</span><span class="p">.</span><span class="nx">mins</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span> <span class="nx">y</span><span class="p">(</span><span class="nx">stop</span><span class="p">.</span><span class="nx">station</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">strokeStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span> <span class="nx">types</span><span class="p">[</span><span class="nx">stop</span><span class="p">.</span><span class="nx">type</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">lineWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Ticks that indicate the stops</span>
<span class="nx">line</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Dot</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">radius</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">lineWidth</span><span class="p">(.</span><span class="mi">75</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">strokeStyle</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span> <span class="nx">types</span><span class="p">[</span><span class="nx">stop</span><span class="p">.</span><span class="nx">type</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">title</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">stop</span><span class="p">)</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">train</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">bound</span> <span class="o">+</span> <span class="s2">&quot;B: &quot;</span>
        <span class="o">+</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">station</span> <span class="o">+</span> <span class="s2">&quot; at &quot;</span> <span class="o">+</span> <span class="nx">stop</span><span class="p">.</span><span class="nx">time</span><span class="p">);</span>

<span class="nx">vis</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>

    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


      <h3>Data</h3>

      Due to size, the data file is omitted from this
      example. See <a href="caltrain.js" target="_blank">caltrain.js</a>.

    </div>

    <div class="foot">
      Copyright 2010 <a href="http://vis.stanford.edu">Stanford Visualization Group</a>
    </div>

    <script type="text/javascript" src="http://www.google-analytics.com/ga.js"></script>
    <script type="text/javascript">_gat._getTracker("UA-10741907-2")._trackPageview();</script>
  </body>
</html>
